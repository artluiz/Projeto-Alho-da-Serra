{% extends "base.html" %} {% load static %}
{% block content %} {% load tz %} 
    <style>
      /* Exemplo de estilo básico, personalize conforme necessário */
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
      }

      .cabecalho {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo-container {
          display: flex;
          align-items: center;
      }

      .logo {
          max-width: 100px;  /* Ajuste conforme necessário */
          margin-right: 10px;  /* Espaço entre o logo e o texto "Controle de aplicações" */
      }
      
      .info-container {
          margin-top: 20px;
          display: flex;
          flex-direction: column;  /* Empilhe os elementos verticalmente */
          align-items: center;
      }

      .numero-recomendacao,
      .data-operacao {
          margin-bottom: 5px;  /* Adicione um espaçamento entre os parágrafos */
      }
      p {
          margin: 0;  /* Remova a margem padrão dos parágrafos para evitar espaços indesejados */
      }

      .campo-selecao {
        margin-top: 5px;
      }
      table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
        }

        th {
            background-color: #f2f2f2;
        }
    </style>
  </head>
  <body>
    <div class="cabecalho">
        <!-- Logo da empresa -->
        <div class="logo-container">
          <img src="{% static '/todos/images/Yui.jpg' %}" alt="Logo da Empresa" class="logo">
            <h1>Controle de aplicações</h1>
        </div>

        <!-- Número da relação e data da operação -->
        <div class="info-container">
          <div class="numero-recomendacao">
              <p>Número da Recomendação: 123</p>
          </div>
          <div class="data-operacao">
              <p>Data da Operação: {% now "d/m/Y" %}</p>
          </div>
      ' </div>
    </div>
    <form method="POST" class="uniForm">
      {% csrf_token %}
      <div>
        <p>Atividade: <select class="campo-selecao">
            {% for atividade in atividades %}
              <option value={{ atividade.pk }}>{{ atividade.nome }}</option>
            {% endfor %}
          </select>
        </p>
      </div>
      <div>
        <p> Estufa: <select class="campo-selecao">
            {% for estufa in estufas %}
              <option value={{ estufa.pk }}>{{ estufa.nome_estufa }}</option>
            {% endfor %}
          </select>
          <p>Área: <input type="numeric" id="id_area" name="area">
            {% if form.errors.area %}
              <!-- Não exibir mensagem de erro para o campo 'area' -->
              {%endif %}
          </p>
        </p>
      </div>
      <div>
        <p> Irrigador: <select class="campo-selecao", id="id_tipo_irrigador">
            {% for tipo_irrigador in tipos_irrigador %}
              <option value={{ tipo_irrigador.pk }}>{{ tipo_irrigador.nome_tipo }}</option>
            {% endfor %}
          </select>
        </p>
      </div>
      <table>
        <thead>
            <tr>
                <th>#</th>
                <th>Produto</th>
                <th>Dose por HÁ</th>
                <th>Setor A</th>
                <th>Setor B</th>
                <th>Anti Câmara</th>
                <th>Consumo Previsto</th>
                <th>Consumo Total</th>
            </tr>
        </thead>
        <tbody>
            {% for i in range %}
              <tr>
                <td>{{ i }}</td>
                <td>
                  <select class="campo-selecao">
                    {% for produto in produtos %}
                      <option value={{ produto.pk }}>{{ produto.nome_produto }}</option>
                    {% endfor %}
                  </select>
                </td>
                <td><input type="number" id="dose_{{ i }}"></td>
                <td><input type="number" id="campo1_{{ i }}" name="campo1_{{ i }}" readonly></td>
                <td><input type="number" id="campo2_{{ i }}" name="campo2_{{ i }}" readonly></td>
                <td><input type="number" id="anti_camara_{{ i }}" name="anti_camara_{{ i }}" readonly></td>
                <td><input type="number" id="previsto_{{ i }}" name="previsto_{{ i }}" readonly></td>
                <td><input type="number" id="total_{{ i }}"></td>
              </tr>
            {% endfor %}
        </tbody>
      </table>
      <button href="{% url "estufa_list"%}" type="submit" class="btn btn-primary btn-sm">Salvar</button>
    </form>

    <!-- Conteúdo da página continua aqui -->
  <script defer>
  document.addEventListener('DOMContentLoaded', function () {
    var areaInput = document.getElementById('id_area');
    var tipoIrrigadorInput = document.getElementById('id_tipo_irrigador');

    var camposDinamicos = document.querySelectorAll('[id^="campo1_"]');

    // Adiciona um ouvinte de evento para o campo de área
    areaInput.addEventListener('input', function () {
      atualizarCampos(camposDinamicos);
    });

    // Adiciona um ouvinte de evento para o campo tipo_irrigador
    tipoIrrigadorInput.addEventListener('change', function () {
      atualizarCampos(camposDinamicos);
    });

    camposDinamicos.forEach(function (campo) {
    var indice = campo.id.split('_')[1];

    // Adiciona um ouvinte de evento para cada campo "dose_"
    var doseInput = document.getElementById('dose_' + indice);
      doseInput.addEventListener('input', function () {
        atualizarCampos(camposDinamicos);
      });
    });

    function atualizarDose(indice){

    }

    function atualizarCampos(camposDinamicos) {
      // Obtenha o valor da área
      var area = parseFloat(areaInput.value) || 0;
      var tipoIrrigador = tipoIrrigadorInput.value;

      if (tipoIrrigador === '1') {
        camposDinamicos.forEach(function (campo) {
          // Extraia o índice do ID (por exemplo, campo1_1, campo1_2, etc.)
          var indice = campo.id.split('_')[1];
          if(document.getElementById('dose_' + indice).value){

          var valorCampo1 = area * indice; //exemplo de cálculo
          var valorCampo2 = area * 2 * indice;

          // Atualize os campos de entrada com os valores calculados
          campo.value = valorCampo1;
          document.getElementById('campo2_' + indice).value = valorCampo2;
          document.getElementById('anti_camara_' + indice).value = "-";

          }
        });
      } else {
        console.log(tipoIrrigador)
        camposDinamicos.forEach(function (campo) {
          // Extraia o índice do ID (por exemplo, campo1_1, campo1_2, etc.)
          var indice = campo.id.split('_')[1];
          if(document.getElementById('dose_' + indice).value){

          var valorAntiCamara = area * 0.8 * indice;  // Exemplo de cálculo para anti_camara

          // Atualize o campo anti_camara com o valor calculado
          document.getElementById('anti_camara_' + indice).value = valorAntiCamara;
          campo.value = '-';
          document.getElementById('campo2_' + indice).value = '-';

          }
        });
      }
      
    }
  });
</script>
  </body>

{% endblock content %}